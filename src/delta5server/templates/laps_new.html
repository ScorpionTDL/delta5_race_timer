{% extends "layout.html" %} {% block title %}Laps{% endblock %} {% block head %} {% endblock %} {% block content %}


<script type="text/javascript" charset="utf-8">
	$(document).ready(function () {
		var socket = io.connect(location.protocol + '//' + document.domain + ':' + location.port);

		socket.emit('load_data', {'load_types': [
			'laps_statistic_data'
		]});

        socket.on('laps_statistic_data', function (msg) {
			var page = $('.page-laps')
            page.empty(); //clean the current page
            
            //if the have data in the top 10 laps we are good to go

            //display the header table with top 10 laps, top # of rounds and average values
            var panel = $('<div class="panel collapsing open">');
            var panel_header = $('<div class="panel-header"><h2>Top Laps over all pilots</h2>');
            panel.append(panel_header);
            var panel_content = $('<div class="panel-content">');
            var Top_Laps_div = $('<div class="race-results">');

            //Top 10 Laps 
            var Top_Laps = $('<div class="node">');
            var Top_laps_Pilot_div = $('<div class="results">');
            var table = $('<table class="laps">');
            var tbody = $('<tbody>');
            Top_laps_Pilot_div.append('<h4> Top 10 laps</h4>')
            for (var lap in msg.total_top_fastes_laps) {
                tbody.append('<tr><td>' + msg.total_top_fastes_laps[lap][0] + '</td><td>' + msg.total_top_fastes_laps[lap][1] + '</td></tr>');
            }
            table.append(tbody);
            Top_laps_Pilot_div.append(table);
            Top_Laps.append(Top_laps_Pilot_div);
            Top_Laps_div.append(Top_Laps);
            //Top Laps per pilot END

            //Top number of laps START
            var Top_Laps = $('<div class="node">');
            var Top_laps_Pilot_div = $('<div class="results">');
            var table = $('<table class="laps">');
            var tbody = $('<tbody>');
            Top_laps_Pilot_div.append('<h4> # of laps completed</h4>')
            for (var lap in msg.top_pilot_lapnumber_array) {
                tbody.append('<tr><td>' + msg.top_pilot_lapnumber_array[lap][0] + '</td><td>' + msg.top_pilot_lapnumber_array[lap][1] + '</td></tr>');
            }
            table.append(tbody);
            Top_laps_Pilot_div.append(table);
            Top_Laps.append(Top_laps_Pilot_div);
            Top_Laps_div.append(Top_Laps);
            //Top number of laps END

            //Top Laps per pilot start
            var Top_Laps = $('<div class="node">');

            var Top_laps_Pilot_div = $('<div class="results">');
            var table = $('<table class="laps">');
            var tbody = $('<tbody>');
            Top_laps_Pilot_div.append('<h4> Top lap per pilot</h4>')
            for (var lap in msg.top_pilot_fastes_lap_array) {
                tbody.append('<tr><td>' + msg.top_pilot_fastes_lap_array[lap][0] + '</td><td>' + msg.top_pilot_fastes_lap_array[lap][1] + '</td></tr>');
            }
            table.append(tbody);
            Top_laps_Pilot_div.append(table);
            Top_Laps.append(Top_laps_Pilot_div);
            Top_Laps_div.append(Top_Laps);
            //Top Laps per pilot END

            //Top 50% avg START
            var Top_Laps = $('<div class="node">');
            var Top_laps_Pilot_div = $('<div class="results">');
            var table = $('<table class="laps">');
            var tbody = $('<tbody>');
            Top_laps_Pilot_div.append('<h4> Top 50% avg</h4>')
            for (var lap in msg.top_pilot_50_avg_array) {
                tbody.append('<tr><td>' + msg.top_pilot_50_avg_array[lap][0] + '</td><td>' + msg.top_pilot_50_avg_array[lap][1] + '</td></tr>');
            }
            table.append(tbody);
            Top_laps_Pilot_div.append(table);
            Top_Laps.append(Top_laps_Pilot_div);
            Top_Laps_div.append(Top_Laps);
            //Top 50% avg END

            //Top 80% avg START
            var Top_Laps = $('<div class="node">');
            var Top_laps_Pilot_div = $('<div class="results">');
            var table = $('<table class="laps">');
            var tbody = $('<tbody>');
            Top_laps_Pilot_div.append('<h4> Top 80% avg</h4>')
            for (var lap in msg.top_pilot_80_avg_array) {
                tbody.append('<tr><td>' + msg.top_pilot_80_avg_array[lap][0] + '</td><td>' + msg.top_pilot_80_avg_array[lap][1] + '</td></tr>');
            }
            table.append(tbody);
            Top_laps_Pilot_div.append(table);
            Top_Laps.append(Top_laps_Pilot_div);
            Top_Laps_div.append(Top_Laps);
            //Top 80% avg END

            //Top 90% avg START
            var Top_Laps = $('<div class="node">');
            var Top_laps_Pilot_div = $('<div class="results">');
            var table = $('<table class="laps">');
            var tbody = $('<tbody>');
            Top_laps_Pilot_div.append('<h4> Top 90% avg</h4>')
            for (var lap in msg.top_pilot_90_avg_array) {
                tbody.append('<tr><td>' + msg.top_pilot_90_avg_array[lap][0] + '</td><td>' + msg.top_pilot_90_avg_array[lap][1] + '</td></tr>');
            }
            table.append(tbody);
            Top_laps_Pilot_div.append(table);
            Top_Laps.append(Top_laps_Pilot_div);
            Top_Laps_div.append(Top_Laps);
            //Top 90% avg END
            




            panel_content.append(Top_Laps_div);
            panel.append(panel_content);

            page.append(panel);


	
		});
	});
</script>
<main class="page-laps">

    <p>Loading...</p>

</main>
<!-- display the fastet laps-->


        {% endblock %}
